<?phpnamespace Admin\Controller;use Think\Controller;class DomainController extends AdminController {    // 游戏域名列表	public function index()     {        // 公共列表        $list = $this->_list();        $this -> assign('list', $list);        $this -> assign('page', $this -> data['page']);        $this -> display();	}    // 推广域名列表    public function generalize()     {        // 公共列表        $list = $this->_list(1);        $this -> assign('list', $list);        $this -> assign('page', $this -> data['page']);        $this -> display();    }	// 编辑、添加	public function edit()    {		$id = intval($_GET['id']);        if ($id > 0) {            $info = M('domain')->find($id);            if (!$info) {                $this->error('操作错误');            }        }        if (IS_POST) {            if ($_POST['id'] > 0) {                $temp_agent = M('domain')->where(array('id' => $_POST['id']))->find();                if (!is_array($temp_agent)) {                    $this->error('信息不存在');                }            } else {                if (empty($_POST['domain'])) {                    $this->error('域名不能为空');                }                $temp_agent = D('domain')->where(array('domain' => $_POST['domain']))->find();                if (is_array($temp_agent)) {                    $this->error('域名已存在');                }            }            // 设置默认域名、默认二维码时 把先前默认去掉            if (!empty($_POST['is_home'])) {                if ($_POST['is_home'] == 1 && !isset($_POST['type'])) {                    M('domain')->where(array('is_home' => 1, 'is_type' => 0))->save(array('is_home' => 0));                }                /*if ($_POST['is_qr_code'] == 1) {                    M('domain')->where(array('is_qr_code' => 1))->save(array('is_qr_code' => 0));                }*/            }        }        if (!isset($_GET['type'])) {            $this -> _edit('domain');        } else {            $this -> _edit('domain', U('generalize'));        }	}	// 删除商品	public function del()    {		$this -> _del('domain', $_GET['id']);		$this -> success('删除成功！');	}    // 公共列表    public function _list($type = 0)    {        $_GET = array_merge($_GET,$_POST);        $where = ['is_type' => $type];        if (!empty($_GET['id'])) {            $where['u.id'] = intval($_GET['id']);        }        if (!empty($_GET['domain'])) {            $where['domain'] = array('like','%'.$_GET['domain'].'%');        }        $table = 'domain';        $order = null;        $model = M($table);        $count = $model ->alias('u')-> where($where) -> count();        $page  = new \Think\Page($count, 25);        if (!$order) {            $order = "id desc";        }        $list = $model//            ->field('u.*,a.username')//            ->alias('u')            //->join('LEFT JOIN '.C('DB_PREFIX').'agent a ON a.id = u.agent_id')        ->where($where) -> limit($page -> firstRow . ',' . $page -> listRows ) -> order($order) -> select();        // 将数据保存到成员变量        $this -> data = array(            'list'  => $list,            'page'  => $page -> show(),            'count' => $count        );        return $list;    }   }