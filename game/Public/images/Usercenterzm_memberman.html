<include file="Public:head"/>
<script src="{weikucms::RES}/js/card/jquery.js"  type="text/javascript" ></script>
<link rel="stylesheet" type="text/css" href="{weikucms::RES}/css/wapwei/victor-client.css">
<link rel="stylesheet" type="text/css" href="{weikucms::RES}/css/cymain.css" />
<script>
    KindEditor.ready(function(K){
        var editor = K.editor({
            allowFileManager:true
        });
        K('#upload').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                    fileUrl : K('#pic').val(),
                    clickFn : function(url, title) {
                        K('#pic').val(url);
                        $("#cardlogo").attr('src',url);
                        editor.hideDialog();
                    }
                });
            });
        });
    });

</script>

<style>
    .a_button {
        display: inline-block;
        position: relative;
        overflow: hidden;
    }
    .codefile {
        position: absolute;
        right: 0;
        top: 0;
        font-size: 100px;
        opacity: 0;
        filter: alpha(opacity =   0);
    }

</style>

    <div class="cLineB">
        <div class="title_tab" id="topTab">
            <ul class="tab_navs title_tab" data-index="0">

                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/index',array('token'=>$token))}" <if condition="$hover eq 1" >class="hover"</if>>用户中心设置</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/memberman',array('token'=>$token))}" <if condition="$hover eq 2" >class="hover"</if>>微信会员管理</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/contact',array('token'=>$token))}" <if condition="$hover eq 3" >class="hover"</if>>客服管理</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Liuyan/index',array('token'=>$token))}" <if condition="$hover eq 4" >class="hover"</if>>会员留言</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/moneyrecord',array('token'=>$token))}" <if condition="$hover eq 6" >class="hover"</if>>消费记录</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/scorerecord',array('token'=>$token))}" <if condition="$hover eq 7" >class="hover"</if>>积分记录</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/smsrecord',array('token'=>$token))}" <if condition="$hover eq 8" >class="hover"</if>>短信记录</a>
                </li>
				<li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Jifenmall/index',array('token'=>$token))}" <if condition="$hover eq 5" >class="hover"</if>>积分商城</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/coupon',array('token'=>$token))}" <if condition="$hover eq 9" >class="hover"</if>>领取优惠券地址设置</a>
                </li>
                <li data-index="0" class="tab_nav first js_top " data-id="total">
                    <a href="{weikucms::U('Usercenterzm/scoreman',array('token'=>$token))}" <if condition="$hover eq 10" >class="hover"</if>>签到积分设置</a>
                </li>
            </ul>
        </div>
    </div>


    <div class="row-fluid">
        <ul id="custom_group_navigator_div" class="qb_clearfix unstyled">

            <li class="list-box" title="点击查看" >
                <div class="list-box__hd list-box__hd_bg_1">本月生日会员</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$membercounts}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>个</div>
                    </div>
                    
                    <div class="list-box__links"></div>
                </div>
                <button class="btn btn-success" style="width:100%" onclick="location.href='{weikucms::U('memberman',array('token'=>$token,'birth'=>'1'))}'">点击查看本月生日会员</button>
                <br/><br/>
                <button class="btn btn-success" style="width:100%" onclick="location.href='{weikucms::U('memberman',array('token'=>$token))}'">点击查看所有会员</button>
            </li>
            

           <!--  <li class="list-box">
                <div class="list-box__hd list-box__hd_bg_1">今日新增会员</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$daymembercounts}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>个</div>
                    </div>
            
                    <div class="list-box__links"></div>
                </div>
            </li>
            
            <li class="list-box">
                <div class="list-box__hd list-box__hd_bg_1">积分</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$addscore[0].addscore}|{weikucms:$subscore[0].subscore}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>个</div>
                    </div>
            
                    <div class="list-box__links"></div>
                </div>
            </li>
            
            <li class="list-box">
                <div class="list-box__hd list-box__hd_bg_2">金额</div>
                <div class="list-box__bd">
                    <div class="list-box__count">
                        <strong class="list-box__total" id="NewToday">{weikucms:$addmoney[0].addmoney}|{weikucms:$submoney[0].submoney}</strong>
                        <div class="list-box__trend" id="NewToday1" style="display:none;"><i class="icon icon-arrow-down"></i>{}个</div>
                    </div>
            
                    <div class="list-box__links"></div>
                </div>
            </li> -->
        </ul>
    </div>

    <div class="msgWrap">

        <div class="box-content">



           <!--  <div class="tab-pane fade active in">
               <form action="" method="post" class="form-horizontal form-validate" novalidate="novalidate">
                   <div class="control-group">
                       <label class="control-label">会员编号字母前缀：</label>
                       <div class="controls">
                           <input type="hidden" name="id" id="id" value="{weikucms:$usercenterdata.id}" class="input-small" data-rule-required="true">
                           <input type="text" placeholder="最多4位" name="u_prefix" id="u_prefix" value="{weikucms:$usercenterdata.u_prefix}" class="input-small" data-rule-required="true">
                           &nbsp; &nbsp; &nbsp;
                           手机短信验证： &nbsp; &nbsp; &nbsp;
                           <select name="is_openphone" id="is_openphone">
                               <option value="0"  <if condition="$usercenterdata['is_openphone'] eq 0">selected</if>>关闭</option>
                               <option value="1"  <if condition="$usercenterdata['is_openphone'] eq 1">selected</if>>开启</option>
                           </select>
           
                           &nbsp; &nbsp; &nbsp; &nbsp; <button id="bsubmit" type="button" data-loading-text="提交中..." class="btn btn-primary">保存</button>
           
                       </div>
           
           
                   </div>
               </form>
           </div> -->
        </div>
    </div>



    <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>提示信息!</strong>
        <ol>
            <li>在这可以查看所有用户的信息</li>
            <li>注意：导入的excel文件后缀名必须为“.xlsx”</li>
            <li>导入订单的订单状态均为已完成</li>
        </ol>
    </div>

    <div class="msgWrap">

        <div class="search_bar_class span12">

            <div class="row span10 left_bar">

                <form action="" method="post" >
                    <div class="input-group input-group-text" style="width:80%">
                        
                        <select class="select-field" id="is_bind" name="is_bind">
                            <option value="" <if condition="$is_bind heq '' ">selected</if>>所有用户</option>
                            <option value="1" <if condition="$is_bind eq 1 ">selected</if>>已绑定手机</option>
                            <option value="0" <if condition="$is_bind heq '0'">selected</if>>未绑定手机</option>
                            
                        </select>
                        
                        <!-- <input  style="width: 150px;" type="text" name="member_sn" value="{weikucms:$member_sn}" placeholder="输入会员卡号查询模糊查询"/> -->
                        <!-- <button class='btn btn-primary' id="import_btn">已</button> -->
                        <input style="width: 150px;" type="text" name="phone" value="{weikucms:$phone}" placeholder="输入会员手机号"/>
                        <input style="width: 120px;" type="text" name="name" value="{weikucms:$name}" placeholder="输入会员名模糊查询"/>
                        <input type="submit" class="btn btn-primary chaxun_btn" value="查询" >
                         </form>
                        
                    </div>
                    <form id="filetm" action="{weikucms::U('Usercenterzm/importcode')}" method="post" enctype="multipart/form-data">

                    <a href="#" class="btn btn-primary a_button" >导入天猫数据
                    <input type="file" name="filetm" class="codefile" style="color:#fff" value="导入天猫商城数据">
                    </a>&nbsp;<a class="btn btn-primary" onclick="location.href='{weikucms::U('tmonline',array('token'=>$token))}'">查看天猫在线订单数据</a>
                    </form>

                    <form id="filejd" action="{weikucms::U('Usercenterzm/importcode')}" method="post" enctype="multipart/form-data">
                    <a class="btn btn-primary a_button">导入京东在线付款数据
                    <input type="file" name="filejd" class="codefile" style="color:#fff"></a>
                    &nbsp;<a class="btn btn-primary" onclick="location.href='{weikucms::U('jdonline',array('token'=>$token))}'">查看京东在线订单数据</a>
                    </form>
                     <form id="filejdoffline" action="{weikucms::U('Usercenterzm/importcode')}" method="post" enctype="multipart/form-data">
                    <a class="btn btn-primary a_button">导入京东货到付款数据
                    <input type="file" name="filejdoffline" class="codefile" style="color:#fff"></a> &nbsp;<a class="btn btn-primary" onclick="location.href='{weikucms::U('jdoffline',array('token'=>$token))}'">查看京东到付订单数据</a>
                    </form> 
                    <!--  <form id="filejdoffline" action="{weikucms::U('Usercenterzm/importcode')}" method="post" enctype="multipart/form-data">
                    <a class="btn btn-primary a_button">导入苏宁货到付款数据
                    <input type="file" name="filejdoffline" class="codefile" style="color:#fff"></a> &nbsp;<a class="btn btn-primary" onclick="location.href='{weikucms::U('suniline',array('token'=>$token))}'">查看苏宁到付订单数据</a>
                    </form>  -->
                    <button class='btn btn-success' id="import_btn">确定导入</button>
                    <button class='btn btn-success' onclick="location.href='{weikucms::U('clearIntegral',array('token'=>$token))}'">积分一键清零</button>
                    <button class='btn btn-success' onclick="location.href='{weikucms::U('selectmember',array('token'=>$token))}'">批删会员</button>
                    <button class='btn btn-success' onclick="location.href='{weikucms::U('memberman',array('token'=>$token,'excel'=>1))}'">导出全部数据</button>
                    <if condition="$_GET['birth'] eq 1">
                    <a href="{weikucms::U('sendbirthsms',array('token'=>$token))}" id="sendbirthsms" class="btn btn-success export_excel">一键发送生日祝福短信</a>
                    </if>
                
            </div>
            
            <!-- <div class="row span2">
                
            
                <a href="{weikucms::U('Usercenter/exportexcel',array('token'=>$token,'status'=>$status,'p'=>$p))}" class="btn btn-primary export_excel">导出Excel</a>
            </div> -->
        </div>

        <div class="box-content">

            <div class="tab-pane fade active in" id="home">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>id</th>
                        <th>会员名称</th>
                        <th>会员等级</th>
                        <th style="width: 70px;">所在平台</th>
                        <th>手机</th>
                        <th>积分</th>
                        <th>消费金额</th>
                        <th>生日</th>
                        <th>是否绑定手机</th>
                        <th style="width: 310px;">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <volist name="list" id="vo">
                        <tr style="text-align:center;">
                            <td>
                                {weikucms:$vo.id}
                            </td>
                            <td>
                                {weikucms:$vo.name}
                            </td>
                            <td>
                                {weikucms:$vo.level}
                            </td>
                            <td >
                                {weikucms:$vo.stage}
                            </td>
                            <td>{weikucms:$vo.phone}</td>
                            <td><span class="badge badge-info">{weikucms:$vo.score}</span></td>
                            <td><span class="badge badge-success">{weikucms:$vo.money}</span></td>
                            <td>
                                {weikucms:$vo.birthday}
                            </td>
                            <td>
                                {weikucms:$vo.is_bind}
                            </td>
                            <td>
                                 <a href="{weikucms::U('Usercenterzm/getmember',array('token'=>$token,'id'=>$vo['id']))}" class="btn btn-success">修改生日</a> 
                                <a href="{weikucms::U('Usercenterzm/moneyrecord',array('id'=>$vo['id'],'token'=>$token))}" class="btn btn-success">消费记录</a>
                                <a href="{weikucms::U('Usercenterzm/smsrecord',array('id'=>$vo['id'],'token'=>$token))}" class="btn btn-success">短信记录</a>
                                <a href="{weikucms::U('Usercenterzm/deletemember',array('id'=>$vo['id'],'token'=>$token))}" class="btn btn-danger deletemember">删除会员</a>
                                <if condition="$vo.is_bind eq '已绑定'">
                                <a href="{weikucms::U('Usercenterzm/scorerecord',array('id'=>$vo['id'],'token'=>$token))}" class="btn btn-success">积分记录</a>
                                </if>
                            </td>
                        </tr>
                    </volist>
                    </tbody>
                </table>

            </div>
            <div>
                <ul class="pager">
                    {weikucms:$page}
                </ul>
            </div>


        </div>



    </div>
    <include file="Public:footer"/>

    <script type="text/javascript">

    $(function(){
        $('.deletemember').click(function(e){
            if(!confirm('真的要删除该会员吗？')){
                e.preventDefault();
            }
        })
        var btn = $("#import_btn");
        $("#import_btn").click(function(){
            //var v= $(".codefile").val();
            
            if($(this).hasClass('on')) return alert('请勿重复操作');
            $(this).addClass('on');
            window.count = 0;
            $(".codefile").each(function(i,x){
                 if($(x).val().length>0){
                    window.formname = $(x).parent().parent().attr('id');
                    window.count ++;
                 }
            })
            if(window.count > 1){
                return alert('单次只能导入一个文件');
            }
            if(!window.count){
                alert('请选择要导入的文件');
            }else{
                if(!confirm('确定导入数据吗？')){
                    return false;
                }
                $("#"+window.formname).ajaxSubmit({
                    dataType:  'json',
                    beforeSend: function() {
                        btn.html("处理中..,导入数据时较慢，请您耐心等待");
                    },
                    /*
                     uploadProgress: function(event, position, total, percentComplete) {
                     var percentVal = percentComplete + '%';
                     btn.html("处理中..("+percentVal+")");
                     },
                     complete: function(xhr) {
                     $(".files").html(xhr.responseText);
                     },*/
                    success: function(data) {
                        //btn.html(data.msg);
                        alert(data.msg);
                        $("#import_btn").removeClass('on');
                        window.location.reload();
                    },
                    error:function(xhr){
                        btn.html("处理失败");
                        $("#import_btn").removeClass('on');
                    }
                });
            }
        });
    });

        $(function(){
            $('#sendbirthsms').click(function(e){
                if(!confirm('确认要一键发送生日祝福短信吗？')){
                    e.preventDefault();
                }
            })
            $("#bsubmit").click(function(){
                var id = $("#id").val();
                var u_prefix = $("#u_prefix").val();
                var is_openphone = $("#is_openphone").val();
                var __hash__ =  $("input[name='__hash__']").val();
                if(!id){
                    notif({
                        msg:"请先到用户中心设置",
                        type: "warning"
                    });
                    return false;
                }

                var patter = /\d+$/;

                if(u_prefix){
                    if(u_prefix.length > 6){
                        notif({
                            msg:"会员编号前缀最多输入6位",
                            type: "warning"
                        });
                        return false;
                    }
                }


                $.post("{weikucms::U('Usercenter/uprefixset',array('token'=>$token))}",
                        {id:id,u_prefix:u_prefix,is_openphone:is_openphone,__hash__:__hash__},
                        function(data){
                            if(data.status == 1){
                                notif({
                                    msg: data.info,
                                    type: "success"
                                });
                                setTimeout(function(){
                                    window.location.reload();
                                },'1000');
                            }else{
                                notif({
                                    msg: data.info,
                                    type: "error"
                                });
                            }
                        },'json');

            });
        });

    </script>

</div>
